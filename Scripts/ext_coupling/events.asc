PROCEDURE global AFTER_EDIT_ATTR_VALUE {
    SETG objId:(instid)
    SETG attrId:(attrid)   
    EXECUTE file:("db:\\editattr.asc")
    CC "Core" GET_ATTR_NAME attrid:(attrid)
    IF (attrname = "Service") {
        ADD_VALUE objID:(objId)
    }
}

PROCEDURE global AFTER_CREATE_MODELING_NODE {
    CC "Core" GET_ATTR_VAL objid:(modelid) attrname:("Model Type")
    IF (val = "PSM") {
        CC "Core" GET_ATTR_VAL objid:(modelid) attrname:("Platform")
        ELEMENT_PSM platform:(val) objID:(objid)
    }
}

PROCEDURE global AFTER_CREATE_MODELING_CONNECTOR {
    SET id_relationclassid: (classid)
    SET id_frominstanceid: (fromobjid)
    SET id_toinstanceid: (toobjid)
    SET id_model: (modelid)
    SET id_conn: (objid)

    CC "Core" GET_CLASS_NAME classid: (id_relationclassid)
    SET str_classname: (classname)

    CC "Core" GET_CONNECTORS objid:(id_toinstanceid) in
    SETL str_objids:(objids)

    # se ho piu' di un connettore dei miei constrain tipi lo blocco

    SETL str_ool:"b"
    FOR str_objid in:(str_objids) sep:" " {
        CC "Core" GET_CLASS_ID objid:(VAL str_objid)    
        CC "Core" GET_CLASS_NAME classid:(classid)   
        IF (classname = "Domain" OR classname = "SpecialCase" OR classname = "Mandatory" OR classname = "Optional" OR classname = "AND" OR classname = "OR" OR classname = "XSSA" OR classname = "XSA" OR classname = "OSA") {
            IF (str_ool = "b") {
                SETL str_ool:"a"
            }
            ELSE {
                CC "Core" DELETE_CONNECTOR modelid:(id_model) objid:(id_conn)
                EXIT -1
            }
        }
    }

    # Devo controllare che posso inserirlo in questo punto
    CC "Core" GET_CONNECTORS objid:(id_frominstanceid) out
    SETL str_objids:(objids)
    
    FOR str_objid in:(str_objids) sep:" " {
        CC "Core" GET_CLASS_ID objid:(VAL str_objid)    
        CC "Core" GET_CLASS_NAME classid:(classid)
            
        IF (str_classname = "AND" OR str_classname = "OR" OR str_classname = "XSSA" OR str_classname = "XSA" OR str_classname = "OSA") {
            IF (classname != str_classname) {
                IF (classname = "DOInput" OR classname = "DOOutput") {

                } ELSE {
                CC "Core" DELETE_CONNECTOR modelid:(id_model) objid:(id_conn)
                EXIT -1
                }
            }
        }
        IF (str_classname = "Mandatory" OR str_classname = "Optional" OR str_classname = "Domain" OR str_classname = "SpecialCase") {
            IF (classname = "OR" OR classname = "AND" OR classname = "XSSA" OR classname = "XSA" OR classname = "OSA") {
                CC "Core" DELETE_CONNECTOR modelid:(id_model) objid:(id_conn)
                EXIT -1
            }
        }
    }    
}

PROCEDURE global ACTIVATE_MODEL_WINDOW {
    CC "Modeling" GET_ACT_MODEL
    CC "Core" GET_MODEL_MODELTYPE modelid:(modelid)
    IF (modeltype = "Feature Operation Model")
    {
        CC "Application" SET_MENU_ITEM_ENABLED component:"modeling" item:("Generate\tDevices operations") enabled:0
    } ELSE {
        CC "Application" SET_MENU_ITEM_ENABLED component:"modeling" item:("Generate\tDevices operations") enabled:1
    }
}